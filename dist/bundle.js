(()=>{"use strict";const e=function(e,t){let n=e.cloneNode();return t.appendChild(n)};window.addEventListener("DOMContentLoaded",(()=>{let t=document.querySelector(".load");window.addEventListener("load",(()=>{t.classList.add("hidden")}));const n=document.querySelector(".score"),o=document.querySelector(".start"),d=document.querySelector(".gameArea"),r=document.createElement("div"),l=document.querySelector(".record"),s=document.querySelector(".complexity"),c=document.querySelector(".backgroundArea"),a=document.querySelector("#complexityRange"),i=document.querySelector(".btnGarage"),p=document.querySelector(".btnGarageClose"),u=document.querySelector(".garage"),y=document.querySelector(".garage__wrap");let m;i.addEventListener("click",(()=>{return(e=u).style.visibility="inherit",e.style.opacity="1",void console.log("Открыл");var e})),p.addEventListener("click",(()=>{return(e=u).style.visibility="hidden",e.style.opacity="0",void console.log("Закрыл");var e}));let f=[];const h=document.createElement("div"),v=document.createElement("div");c.appendChild(v);const L=document.createElement("button");let g=new Audio;function E(e){"Enter"===e.code&&function(){s.classList.add("hide"),o.classList.add("hide"),document.removeEventListener("keydown",E),x.speed=+a.value,x.start=!0,d.innerHTML="",c.innerHTML="",r.style.left="125px",r.style.top="80%";for(let e=0;e<10;e++){const t=document.createElement("div");t.classList.add("line"),t.style.top=80*e+"px",t.y=82*e,d.appendChild(t)}for(let e=0;e<5;e++){const t=document.createElement("div");t.classList.add("house"),t.style.backgroundImage='url("./image/home.webp")',t.style.top=82*e*-1+"px";let n=Math.random()*(c.offsetWidth-100);(n>900||n<400)&&(t.style.left=n+"px"),t.y=120*e,c.appendChild(t)}for(let e=1;e<4;e++){const t=document.createElement("div");t.classList.add("enemy"),t.style.top=100*e+"px",t.y=-100*x.traffic*e+1,console.log(t.y),t.style.top=t.y+"px",t.style.left=Math.random()*(d.offsetWidth-50)+"px",d.appendChild(t)}x.score=0,d.appendChild(r),x.x=r.offsetLeft,x.y=r.offsetTop,A()}()}r.classList.add("car"),document.addEventListener("keydown",(function(e){e.preventDefault(),w[e.key]=!0})),document.addEventListener("keyup",(function(e){w[e.key]=!1}));const w={ArrowUp:!1,ArrowDown:!1,ArrowRight:!1,ArrowLeft:!1},x={start:!1,score:0,speed:0,traffic:3};let C,k=0;const b=[["Эй, придурок. Мне сказали, ты хочешь бросить вызов моим парням? Думаешь, мы дадим шанс какому-то выскочке? Для начала набери 20 000 очков чтобы показать себя"],["Неплохо, придурок, но для нас ты всё равно лох"]];let S=new Promise((function(e,t){C=function(){v.classList.add("dialogArea"),h.classList.add("enemyBoss"),h.style.display="block",v.style.display="block",c.appendChild(v),c.appendChild(h);let t=b[k].toString().split("");console.log(k);let n=.02;t.map((t=>{let o=document.createElement("span");o.textContent=t,o.style.animation=`1s ghost ${n}s forwards`,n+=.02,e(v.appendChild(o))}))},C()}));function A(){x.start&&(x.score+=x.speed,n.textContent=x.score,function(){let e=document.querySelectorAll(".line");for(let t of e)t.y+=x.speed,t.style.top=t.y+"px",parseInt(t.style.top)>d.offsetHeight&&(t.y=-82)}(),function(){let e=document.querySelectorAll(".enemy");for(let t of e){let e=r.getBoundingClientRect(),n=t.getBoundingClientRect();if(e.top<n.bottom&&e.right>n.left&&e.left<n.right&&e.bottom>n.top&&(x.start=!1,o.classList.remove("hide"),s.classList.remove("hide"),g.pause(),g.currentTime=0,f.push(x.score),l.innerHTML="Рекорд = "+Math.max(...f),document.addEventListener("keydown",E)),t.y+=x.speed,t.style.top=t.y+"px",t.y>document.documentElement.clientHeight){t.y=-100*x.traffic,t.style.left=Math.random()*(d.offsetWidth-50)+"px";let e=Math.round(3*Math.random())+1;t.style.background=`url('./image/enemy/${e}.webp') center / cover no-repeat`}}}(),function(){let e=document.querySelectorAll(".house");for(let t of e)if(t.y+=x.speed,t.style.top=t.y+"px",parseInt(t.style.top)>d.offsetHeight){t.y=-120;let e=Math.random()*(c.offsetWidth-100);(e>900||e<400)&&(t.style.left=e+"px")}}(),w.ArrowLeft&&x.x>0&&(x.x-=x.speed),w.ArrowRight&&x.x<d.offsetWidth-r.offsetWidth&&(x.x+=x.speed),w.ArrowUp&&x.y>0&&(x.y-=x.speed),w.ArrowDown&&x.y<d.offsetHeight-r.offsetHeight&&(x.y+=x.speed),r.style.left=x.x+"px",r.style.top=x.y+"px",m=requestAnimationFrame(A)),x.score>19999&&x.score<20005&&(q(),C(),S.then((()=>{k++,setTimeout((()=>{v.appendChild(L),L.textContent="Ехать дальше",L.addEventListener("click",(()=>{v.innerHTML=" ",v.style.display="none",h.style.display="none",M()}))}),1e3)})),x.score+=5)}function q(e="Space"){"Space"!==e.code&&"Space"!=e||(window.cancelAnimationFrame(m),document.removeEventListener("keydown",q),document.addEventListener("keydown",M))}function M(e="Space"){"Space"!==e.code&&"Space"!=e||(m=window.requestAnimationFrame(A),document.addEventListener("keydown",q),document.removeEventListener("keydown",M),document.removeEventListener("keydown",E))}S.then((()=>{k++,setTimeout((()=>{v.appendChild(L),L.textContent="Начать",L.addEventListener("click",(()=>{v.innerHTML=" ",v.style.display="none",h.style.display="none",document.addEventListener("keydown",E)}))}),1e3)})),function(){let t=document.createElement("div");t.classList.add("buyCarWrap");let n=document.createElement("div");n.classList.add("buyCar");let o=document.createElement("span"),d=document.createElement("button");d.classList.add("btnBuy"),d.textContent="Купить";let l=[];for(let o=1;o<3;o++){let s=document.createElement("div");s.classList.add("buyCarItem"),s.style.background=`transparent url('./image/car/${o}.png') center / cover no-repeat`,n.appendChild(s),l.push(s),s.addEventListener("click",(function(o){l.forEach((e=>{e.style.border="none"}));let s=o.target;s.style.border="2px solid green",d.addEventListener("click",(function(){r.style.background=s.style.background,t.style.display="none",e(r,y)})),n.appendChild(d)}))}o.textContent="Купить машину",t.appendChild(o),t.appendChild(n),document.body.appendChild(t)}(),document.addEventListener("keydown",q)}))})();